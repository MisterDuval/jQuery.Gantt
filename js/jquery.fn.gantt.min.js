// jQuery Gantt Chart
// ==================
// Basic usage:
//      $(".selector").gantt({
//          source: "ajax/data.json",
//          scale: "weeks",
//          minScale: "weeks",
//          maxScale: "months",
//          onItemClick: function(data) {
//              alert("Item clicked - show some details");
//          },
//          onAddClick: function(dt, rowId) {
//              alert("Empty space clicked - add an item!");
//          },
//          onRender: function() {
//              console.log("chart rendered");
//          }
//      });
//
!function(e,t){"use strict";Date.prototype.getWeekId=function(){var e=this.getFullYear(),t=this.getWeekOfYear(),a=this.getMonth();return 11===a&&1===t?e++:!a&&t>51&&e--,e+"-"+t},Date.prototype.getRepDate=function(e){switch(e){case"weeks":return this.getDayForWeek().getTime();case"months":return new Date(this.getFullYear(),this.getMonth(),1).getTime();case"hours":case"days":default:return this.getTime()}},Date.prototype.getDayOfYear=function(){var e=this.getFullYear();return(Date.UTC(e,this.getMonth(),this.getDate())-Date.UTC(e,0,0))/864e5};function a(e,t){for(var a=1;;a++){var n=new Date(e);if(n.setHours(e.getHours()+t*a),n.getTime()!==e.getTime())return n}}Date.prototype.getWeekOfYear=function(){var e=this.getFullYear(),t=this.getMonth(),a=this.getDate(),n=this.getDay(),l=4-n;return n<1&&(l-=7),l+7<3&&(l+=7),Math.ceil(new Date(e,t,a+l).getDayOfYear()/7)},Date.prototype.getDayForWeek=function(){var e=this.getDay(),t=1+(e<1?-7:0)-e;return new Date(this.getFullYear(),this.getMonth(),this.getDate()+t)},e.fn.gantt=function(t){var n=["hours","hours3","hours6","hours12","days","weeks","months"],l={hours:{scaleGroup:"hours",scaleStep:1},hours3:{scaleGroup:"hours",scaleStep:3},hours6:{scaleGroup:"hours",scaleStep:6},hours12:{scaleGroup:"hours",scaleStep:12},days:{scaleGroup:"days",scaleStep:1},weeks:{scaleGroup:"weeks",scaleStep:1},months:{scaleGroup:"months",scaleStep:1}},i={hours:{headerRows:5,cellStep:36e5},days:{headerRows:4,cellStep:864e5},weeks:{headerRows:3,cellStep:6048e5},months:{headerRows:2}},o={source:[],holidays:[],itemsPerPage:7,itemsPerPageSelect:[],dow:["S","M","T","W","T","F","S"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],waitText:"Please wait...",navigate:"buttons",navigationPosition:"bottom",scrollToToday:!0,useCookie:!1,cookieKey:"jquery.fn.gantt",scale:"days",maxScale:"months",minScale:"hours",onItemClick:function(e){},onAddClick:function(e,t){},onRender:e.noop,highlightRow:!0,snapToGrid:!0};e.extend(o,t),o.scale=e.inArray(o.scale,n)>=0?o.scale:"days",o.maxScale=e.inArray(o.maxScale,n)>=0?o.maxScale:n[n.length-1],o.minScale=e.inArray(o.minScale,n)>=0?o.minScale:n[0],o.maxScale=e.inArray(o.scale,n)<=e.inArray(o.maxScale,n)?o.maxScale:o.scale,o.minScale=e.inArray(o.scale,n)>=e.inArray(o.minScale,n)?o.minScale:o.scale,o.useCookie=o.useCookie&&e.isFunction(e.cookie);var s={elementFromPoint:"CSS1Compat"===document.compatMode?function(e,t){return e-=window.pageXOffset,t-=window.pageYOffset,document.elementFromPoint(e,t)}:function(t,a){return t-=e(document).scrollLeft(),a-=e(document).scrollTop(),document.elementFromPoint(t,a)},create:function(t){"string"!=typeof o.source?(t.data=o.source,s.init(t)):e.getJSON(o.source,function(e){t.data=e,s.init(t)})},init:function(e){e.rowsNum=e.data.length,e.pageCount=Math.ceil(e.rowsNum/o.itemsPerPage),e.rowsOnLastPage=e.rowsNum-Math.floor(e.rowsNum/o.itemsPerPage)*o.itemsPerPage,e.dateStart=r.getMinDate(e),e.dateEnd=r.getMaxDate(e),s.waitToggle(e,function(){s.render(e)})},render:function(t){var a=e('<div class="fn-content"/>'),n=s.leftPanel(t);a.append(n);var l,i=s.rightPanel(t,n);a.append(i),"top"===o.navigationPosition?a.prepend(s.navigation(t)):a.append(s.navigation(t));var r=i.find(".dataPanel");if(t.gantt=e('<div class="fn-gantt" />').append(a),e(t).empty().append(t.gantt),t.scrollNavigation.panelMaxPos=-1*(r.width()-i.width()),t.scrollNavigation.canScroll=r.width()>i.width(),s.markNow(t),s.fillData(t,r,n),null!==t.highlightedRow&&s.highlightRow(t,t.highlightedRow),o.useCookie){var d=e.cookie(o.cookieKey+"ScrollPos");d&&(t.hPosition=parseInt(d,10))}o.scrollToToday?(s.navigateTo(t,"now"),s.scrollPanel(t,0),o.scrollToToday=!1):(0!==t.hPosition&&(t.scaleOldWidth&&(l=(r.width()-i.width())*t.hPosition/t.scaleOldWidth,t.hPosition=l>0?0:l,t.scaleOldWidth=null),r.css("margin-left",t.hPosition),t.scrollNavigation.panelMargin=t.hPosition,s.synchronizeScroller(t)),s.repositionLabel(t)),s.switchScrollButton(t),r.css({height:n.height()}),s.waitToggle(t),o.onRender()},leftPanel:function(t){var a=i[t.scaleGroup].headerRows,n=e('<div class="leftPanel"/>').append(e('<div class="row spacer"/>').css("height",r.getCellSize()*a+1).css("width","100%"));return e.each(t.data,function(a,l){if(a>=t.pageNum*o.itemsPerPage&&a<t.pageNum*o.itemsPerPage+o.itemsPerPage){var i=e("<div>").addClass("row name").addClass("row"+a).addClass(l.desc?"":"fn-wide").attr("id","rowheader"+a).data("offset",a%o.itemsPerPage*r.getCellSize()).data("id",l.id).append(e("<span>").addClass("fn-label").addClass(l.cssClass?l.cssClass:"").text(l.name||""));if(s.setRowClick(t,i,a),n.append(i),l.desc){var d=e("<div>").addClass("row desc").addClass("row"+a).attr("id","RowdId_"+a).data("id",l.id).append(e("<span>").addClass("fn-label").addClass(l.cssClass?l.cssClass:"").text(l.desc));s.setRowClick(t,d,a),n.append(d)}}}),n},dataPanel:function(t,a){var n=e('<div class="dataPanel" style="width: '+a+'px;"/>'),l="onwheel"in t?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";return e(t).on(l,function(e){s.wheelScroll(t,e)}),n.click(function(a){var n;a.stopPropagation();var l=e(t).find(".fn-gantt .leftPanel"),d=e(t).find(".fn-gantt .dataPanel");n=r.getCellSize()*(i[t.scaleGroup].headerRows-1);var c=s.elementFromPoint(a.pageX,d.offset().top+n),g=(c="fn-label"===c.className?e(c.parentNode):e(c)).data("repdate"),u=s.elementFromPoint(l.offset().left+l.width()-10,a.pageY),h=(u=0===u.className.indexOf("fn-label")?e(u.parentNode):e(u)).data("id");o.onAddClick(g,h)}),n},rightPanel:function(t,n){var i=null,d=["sn","wd","wd","wd","wd","wd","sa"],c=[],g=0,u=[],h=0,p=[],v=0,f=[],m=[],w=new Date;w.setHours(0,0,0,0);var y,b,P,D,S,k,M,C,N,T=e('<div class="row header"></div>');switch(t.scaleGroup){case"hours":var x=l[o.scale].scaleStep;for(P=(i=r.parseTimeRange(t.dateStart,t.dateEnd,x))[0].getFullYear(),D=i[0].getMonth(),k=i[0],y=0,b=i.length;y<b;y++){var z=(M=i[y]).getFullYear();z!==P&&(c.push('<div class="row header year" style="width: '+r.getCellSize()*g+'px;"><div class="fn-label">'+P+"</div></div>"),P=z,g=0),g++;var F=M.getMonth();F!==D&&(u.push('<div class="row header month" style="width: '+r.getCellSize()*h+'px"><div class="fn-label">'+o.months[D]+"</div></div>"),D=F,h=0),h++;var Y=M.getDay(),R=k.getDay();Y!==R&&(C=w-k==0?"today":r.isHoliday(k.getTime())?"holiday":d[R],p.push('<div class="row date '+C+'" style="width: '+r.getCellSize()*v+'px;"><div class="fn-label">'+k.getDate()+"</div></div>"),f.push('<div class="row day '+C+'" style="width: '+r.getCellSize()*v+'px;"><div class="fn-label">'+o.dow[R]+"</div></div>"),k=M,v=0),v++,C=d[Y],r.isHoliday(M)&&(C="holiday"),m.push('<div class="row day '+C+'" id="dh-'+M.getTime()+'" data-offset="'+y*r.getCellSize()+'" data-repdate="'+M.getRepDate(t.scaleGroup)+'"><div class="fn-label">'+M.getHours()+"</div></div>")}c.push('<div class="row header year" style="width: '+r.getCellSize()*g+'px;"><div class="fn-label">'+P+"</div></div>"),u.push('<div class="row header month" style="width: '+r.getCellSize()*h+'px"><div class="fn-label">'+o.months[D]+"</div></div>"),C=d[k.getDay()],r.isHoliday(k)&&(C="holiday"),p.push('<div class="row date '+C+'" style="width: '+r.getCellSize()*v+'px;"><div class="fn-label">'+k.getDate()+"</div></div>"),f.push('<div class="row day '+C+'" style="width: '+r.getCellSize()*v+'px;"><div class="fn-label">'+o.dow[k.getDay()]+"</div></div>"),(N=s.dataPanel(t,i.length*r.getCellSize())).append(T.clone().html(c.join("")),T.clone().html(u.join("")),T.clone().html(p.join("")),T.clone().html(f.join("")),T.clone().html(m.join("")));break;case"weeks":var H;for(P=(i=r.parseWeeksRange(t.dateStart,t.dateEnd))[0].getFullYear(),D=i[0].getMonth(),S=i[0].getWeekOfYear(),y=0,b=i.length;y<b;y++)S>(S=(M=i[y]).getWeekOfYear())&&(H=M.getDate()-1,H-=M.getMonth()?31:0,H/=7,c.push('<div class="row header year" style="width: '+r.getCellSize()*(g-H)+'px;"><div class="fn-label">'+P+"</div></div>"),P++,g=H),g++,M.getMonth()!==D&&(H=M.getDate()-1,H/=7,u.push('<div class="row header month" style="width:'+r.getCellSize()*(h-H)+'px;"><div class="fn-label">'+o.months[D]+"</div></div>"),D=M.getMonth(),h=H),h++,p.push('<div class="row day wd" id="dh-'+M.getWeekId()+'" data-offset="'+y*r.getCellSize()+'" data-repdate="'+M.getRepDate(t.scaleGroup)+'"><div class="fn-label">'+S+"</div></div>");c.push('<div class="row header year" style="width: '+r.getCellSize()*g+'px;"><div class="fn-label">'+P+"</div></div>"),u.push('<div class="row header month" style="width: '+r.getCellSize()*h+'px"><div class="fn-label">'+o.months[D]+"</div></div>"),(N=s.dataPanel(t,i.length*r.getCellSize())).append(T.clone().html(c.join("")),T.clone().html(u.join("")),T.clone().html(p.join("")));break;case"months":for(P=(i=r.parseMonthsRange(t.dateStart,t.dateEnd))[0].getFullYear(),D=i[0].getMonth(),y=0,b=i.length;y<b;y++)(M=i[y]).getFullYear()!==P&&(c.push('<div class="row header year" style="width: '+r.getCellSize()*g+'px;"><div class="fn-label">'+P+"</div></div>"),P=M.getFullYear(),g=0),g++,u.push('<div class="row day wd" id="dh-'+r.genId(M)+'" data-offset="'+y*r.getCellSize()+'" data-repdate="'+M.getRepDate(t.scaleGroup)+'">'+(1+M.getMonth())+"</div>");c.push('<div class="row header year" style="width: '+r.getCellSize()*g+'px;"><div class="fn-label">'+P+"</div></div>"),u.push('<div class="row header month" style="width: '+r.getCellSize()*h+'px"><div class="fn-label">'+o.months[D]+"</div></div>"),(N=s.dataPanel(t,i.length*r.getCellSize())).append(T.clone().html(c.join("")),T.clone().html(u.join("")),T.clone().html(p.join("")),T.clone().html(f.join("")));break;default:var G=a((i=r.parseDateRange(t.dateStart,t.dateEnd))[0],-1);for(P=G.getFullYear(),D=G.getMonth(),y=0,b=i.length;y<b;y++)(M=i[y]).getFullYear()!==P&&(c.push('<div class="row header year" style="width:'+r.getCellSize()*g+'px;"><div class="fn-label">'+P+"</div></div>"),P=M.getFullYear(),g=0),g++,M.getMonth()!==D&&(u.push('<div class="row header month" style="width:'+r.getCellSize()*h+'px;"><div class="fn-label">'+o.months[D]+"</div></div>"),D=M.getMonth(),h=0),h++,C=d[k=M.getDay()],r.isHoliday(M)&&(C="holiday"),p.push('<div class="row date '+C+'" id="dh-'+r.genId(M)+'" data-offset="'+y*r.getCellSize()+'" data-repdate="'+M.getRepDate(t.scaleGroup)+'"><div class="fn-label">'+M.getDate()+"</div></div>"),f.push('<div class="row day '+C+'" id="dw-'+r.genId(M)+'" data-repdate="'+M.getRepDate(t.scaleGroup)+'"><div class="fn-label">'+o.dow[k]+"</div></div>");c.push('<div class="row header year" style="width: '+r.getCellSize()*g+'px;"><div class="fn-label">'+P+"</div></div>"),u.push('<div class="row header month" style="width: '+r.getCellSize()*h+'px"><div class="fn-label">'+o.months[D]+"</div></div>"),(N=s.dataPanel(t,i.length*r.getCellSize())).append(T.clone().html(c.join("")),T.clone().html(u.join("")),T.clone().html(p.join("")),T.clone().html(f.join("")))}return e('<div class="rightPanel"></div>').append(N)},navigation:function(t){var a=null;return"scroll"===o.navigate?(a=e('<div class="navigate" />').append(e('<div class="nav-slider" />').append(e('<div class="nav-slider-left" />').append(s.pageNavigation(t)).append(e('<button type="button" class="nav-link nav-now"/>').html("&#9679;").click(function(){s.navigateTo(t,"now")})).append(e('<button type="button" class="nav-link nav-prev-week"/>').html("&lt;&lt;").click(function(){s.navigateTo(t,8*r.getCellSize())})).append(e('<button type="button" class="nav-link nav-prev-day"/>').html("&lt;").click(function(){s.navigateTo(t,4*r.getCellSize())}))).append(e('<div class="nav-slider-content" />').append(e('<div class="nav-slider-bar" />').append(e('<a class="nav-slider-button" />')).mousedown(function(e){e.preventDefault(),t.scrollNavigation.scrollerMouseDown=!0,s.sliderScroll(t,e)}).mousemove(function(e){t.scrollNavigation.scrollerMouseDown&&s.sliderScroll(t,e)}))).append(e('<div class="nav-slider-right" />').append(e('<button type="button" class="nav-link nav-next-day"/>').html("&gt;").click(function(){s.navigateTo(t,-4*r.getCellSize())})).append(e('<button type="button" class="nav-link nav-next-week"/>').html("&gt;&gt;").click(function(){s.navigateTo(t,-8*r.getCellSize())})).append(s.zoomNavigate(t)))),e(document).mouseup(function(){t.scrollNavigation.scrollerMouseDown=!1})):a=e('<div class="navigate" />').append(s.pageNavigation(t)).append(e('<button type="button" class="nav-link nav-begin"/>').html("&#124;&lt;").click(function(){s.navigateTo(t,"begin")})).append(e('<button type="button" class="nav-link nav-prev-week"/>').html("&lt;&lt;").click(function(){s.navigateTo(t,8*r.getCellSize())})).append(e('<button type="button" class="nav-link nav-prev-day"/>').html("&lt;").click(function(){s.navigateTo(t,4*r.getCellSize())})).append(e('<button type="button" class="nav-link nav-now"/>').html("&#9679;").click(function(){s.navigateTo(t,"now")})).append(e('<button type="button" class="nav-link nav-next-day"/>').html("&gt;").click(function(){s.navigateTo(t,-4*r.getCellSize())})).append(e('<button type="button" class="nav-link nav-next-week"/>').html("&gt;&gt;").click(function(){s.navigateTo(t,-8*r.getCellSize())})).append(e('<button type="button" class="nav-link nav-end"/>').html("&gt;&#124;").click(function(){s.navigateTo(t,"end")})).append(s.zoomNavigate(t)),e('<div class="bottom"></div>').append(a)},pageNavigation:function(t){return e('<button type="button" class="nav-link nav-page-back"/>').prop("disabled",0===t.pageNum).html("&lt;").click(function(){s.navigatePage(t,-1)}).add(e('<div class="page-number"/>').append(e("<span/>").html(t.pageNum+1+" / "+t.pageCount))).add(e('<button type="button" class="nav-link nav-page-next"/>').prop("disabled",t.pageNum+1===t.pageCount).html("&gt;").click(function(){s.navigatePage(t,1)})).add(o.itemsPerPageSelect.length<=0?"":s.getSelect(o.itemsPerPageSelect).addClass("nav-page-select").change(function(){var a=o.itemsPerPage;o.itemsPerPage=Number(e(this).val());var n=t.pageNum*a,l=Math.min((t.pageNum+1)*a-1,t.rowsNum-1),i=t.highlightedRow&&t.highlightedRow>=n&&t.highlightedRow<=l?t.highlightedRow:n;t.pageNum=Math.floor(i/o.itemsPerPage),t.hPosition=e(".fn-gantt .dataPanel").css("margin-left").replace("px",""),t.hPosition=parseInt(t.hPosition,10),s.refresh(t)}))},zoomNavigate:function(t){return e('<button type="button" class="nav-link nav-zoomIn"/>').prop("disabled",o.scale==o.minScale).html("&#43;").click(function(){s.zoomInOut(t,-1)}).add(e('<button type="button" class="nav-link nav-zoomOut"/>').prop("disabled",o.scale==o.maxScale).html("&#45;").click(function(){s.zoomInOut(t,1)}))},getSelect:function(t){var a=e("<select>");return e.each(t,function(t,n){a.append(e("<option>").text(n).val(n).prop("selected",n===o.itemsPerPage))}),a},createProgressBar:function(t,a,n,l,i){a=a||"";var s=r.getCellSize(),d=Math.floor(s/4),c=r.getProgressBarMargin()||0,g=e('<div class="bar"><div class="fn-label">'+a+"</div></div>").css({width:Math.max(Math.floor(s*t),d)-c+2}).data("dataObj",i);return n&&g.mouseenter(function(t){var a=e('<div class="fn-gantt-hint" />').html(n);e("body").append(a),a.css("left",t.pageX),a.css("top",t.pageY),a.show()}).mouseleave(function(){e(".fn-gantt-hint").remove()}).mousemove(function(t){e(".fn-gantt-hint").css("left",t.pageX),e(".fn-gantt-hint").css("top",t.pageY+15)}),l&&g.addClass(l),g.click(function(t){t.stopPropagation(),o.onItemClick(e(this).data("dataObj"))}),g},markNow:function(t){var a=(new Date).setHours(0,0,0,0),n=l[o.scale].scaleStep;e(t).find("#dh-"+r.genId(a,n)).removeClass("wd").addClass("today");var i=e(t).find(".fn-gantt .rightPanel .dataPanel");e(t).find(".fn-gantt .bottom .navigate button.nav-now").prop("disabled",!t.scrollNavigation.canScroll||!i.find(".today").length)},fillData:function(t,a,n){e.each(t.data,function(n,d){n>=t.pageNum*o.itemsPerPage&&n<t.pageNum*o.itemsPerPage+o.itemsPerPage&&e.each(d.values,function(d,c){var g,u,h,p,v,f,m,w,y,b,P,D,S=i[t.scaleGroup].headerRows,k=l[o.scale].scaleStep,M=k*i[t.scaleGroup].cellStep;switch(f=r.dateDeserialize(c.from),m=r.dateDeserialize(c.to),u=e(t).find("#dh-"+r.genId(f,k)),h=e(t).find("#dh-"+r.genId(m,k)),p=u.data("offset"),v=h.data("offset"),t.scaleGroup){case"hours":var C=Math.floor(f.getHours()/k)*k;w=f-new Date(f.getFullYear(),f.getMonth(),f.getDate(),C).getTime(),C=Math.floor(m.getHours()/k)*k,y=m-new Date(m.getFullYear(),m.getMonth(),m.getDate(),C).getTime();break;case"weeks":w=f-f.getDayForWeek().getTime(),y=m-m.getDayForWeek().getTime();break;case"months":w=f-new Date(f.getFullYear(),f.getMonth(),1).getTime(),y=m-new Date(m.getFullYear(),m.getMonth(),1).getTime();break;case"days":default:w=f-new Date(f.getFullYear(),f.getMonth(),f.getDate()).getTime(),y=m-new Date(m.getFullYear(),m.getMonth(),m.getDate()).getTime()}o.snapToGrid?(b=(v-p)/r.getCellSize(),0!==y&&b++):("months"==t.scaleGroup&&(M=864e5*new Date(f.getFullYear(),f.getMonth()+1,0).getDate()),p+=w%M/(1*M)*r.getCellSize(),"months"==t.scaleGroup&&(M=864e5*new Date(m.getFullYear(),m.getMonth()+1,0).getDate()),b=((v+=y%M/(1*M)*r.getCellSize())-p)/r.getCellSize(),p=Math.round(p)),g=s.createProgressBar(b,c.label,c.desc,c.customClass,c.dataObj),P=e(t).find("#rowheader"+n),D=r.getCellSize()*S+2+P.data("offset"),g.css({top:D,left:Math.floor(p)}),a.append(g);var N=g.find(".fn-label");if(N&&g.length){var T=function(e){try{var t=(e=e.replace("rgb(","").replace(")","")).split(","),a=parseInt(t[0],10),n=parseInt(t[1],10),l=parseInt(t[2],10),i=Math.round(.9*(255-(.299*a+.587*n+.114*l)));return"rgb("+i+", "+i+", "+i+")"}catch(e){return""}}(g[0].style.backgroundColor);N.css("color",T)}else N&&N.css("color","")})})},setRowClick:function(t,a,n){a.click(function(){if(o.highlightRow){if(e(t).find(".fn-gantt .rightPanel .dataPanel .highlight").remove(),t.highlightedRow===n)return t.highlightedRow=null,!1;s.highlightRow(t,n)}})},highlightRow:function(t,a){var n=e(t).find(".fn-gantt .rightPanel .dataPanel"),l=e(t).find("#rowheader"+a);if(l.length>0){var o=i[t.scaleGroup].headerRows,s=r.getCellSize()*o+l.data("offset"),d=e("<div>").addClass("highlight").css("top",s);n.append(d),t.highlightedRow=a}},navigateTo:function(t,a){if(t.scrollNavigation.canScroll){var n,l=e(t).find(".fn-gantt .rightPanel .dataPanel");switch(a){case"begin":n=0;break;case"end":n=t.scrollNavigation.panelMaxPos;break;case"now":if(!l.find(".today").length)return!1;n=l.find(".today").offset().left-l.offset().left,n=(n=(n*=-1)<0?n:0)>t.scrollNavigation.panelMaxPos?n:t.scrollNavigation.panelMaxPos;break;default:n=parseInt(l.css("margin-left").replace("px",""),10),n=(n=(n+=a)<0?n:0)>t.scrollNavigation.panelMaxPos?n:t.scrollNavigation.panelMaxPos}l.animate({"margin-left":n},"fast",function(){s.switchScrollButton(t),s.repositionLabel(t)}),s.synchronizeScroller(t)}},navigatePage:function(t,a){t.pageNum+a>=0&&t.pageNum+a<Math.ceil(t.rowsNum/o.itemsPerPage)&&s.waitToggle(t,function(){t.pageNum+=a,t.hPosition=e(".fn-gantt .dataPanel").css("margin-left").replace("px",""),t.hPosition=parseInt(t.hPosition,10),t.scaleOldWidth=!1,s.init(t)})},refresh:function(e){s.create(e)},zoomInOut:function(t,a){s.waitToggle(t,function(){var i=a<0,r=e.inArray(o.scale,n);if(i&&r<=e.inArray(o.minScale,n)||!i&&r>=e.inArray(o.maxScale,n))s.waitToggle(t);else{r=i?r-1:r+1,o.scale=n[r],t.scaleGroup=l[o.scale].scaleGroup;var d=e(t).find(".fn-gantt .rightPanel"),c=d.find(".dataPanel");t.hPosition=c.css("margin-left").replace("px",""),t.hPosition=parseInt(t.hPosition,10),t.scaleOldWidth=c.width()-d.width(),o.useCookie&&(e.cookie(o.cookieKey+"CurrentScale",o.scale),e.cookie(o.cookieKey+"ScrollPos",null)),s.init(t)}})},mouseScroll:function(t,a){var n=e(t).find(".fn-gantt .dataPanel");n.css("cursor","move");n.offset();var l=null===t.scrollNavigation.mouseX?a.pageX:t.scrollNavigation.mouseX,i=a.pageX-l;t.scrollNavigation.mouseX=a.pageX,s.scrollPanel(t,i),clearTimeout(t.scrollNavigation.repositionDelay),t.scrollNavigation.repositionDelay=setTimeout(s.repositionLabel,50,t)},wheelScroll:function(e,t){t.preventDefault();var a="detail"in t?t.detail:"wheelDelta"in t.originalEvent?-1/120*t.originalEvent.wheelDelta:t.originalEvent.deltaY?t.originalEvent.deltaY/Math.abs(t.originalEvent.deltaY):t.originalEvent.detail;s.scrollPanel(e,-50*a),clearTimeout(e.scrollNavigation.repositionDelay),e.scrollNavigation.repositionDelay=setTimeout(s.repositionLabel,50,e)},sliderScroll:function(t,a){var n=e(t).find(".nav-slider-bar"),l=n.find(".nav-slider-button"),i=e(t).find(".fn-gantt .rightPanel .dataPanel"),o=n.offset(),r=n.width(),d=l.width(),c=a.pageX-o.left;c=(c=c<0?0:c)>r?r:c,l.css("left",c-d/2);var g=c*t.scrollNavigation.panelMaxPos/r;i.css("margin-left",g),s.switchScrollButton(t),clearTimeout(t.scrollNavigation.repositionDelay),t.scrollNavigation.repositionDelay=setTimeout(s.repositionLabel,5,t)},scrollPanel:function(t,a){if(!t.scrollNavigation.canScroll)return!1;var n=e(t).find(".fn-gantt .dataPanel"),l=parseInt(n.css("margin-left").replace("px",""),10);l=(l=(l+=a)<=0?l:0)>=t.scrollNavigation.panelMaxPos?l:t.scrollNavigation.panelMaxPos,n.css("margin-left",l),s.switchScrollButton(t),s.synchronizeScroller(t)},synchronizeScroller:function(t){if("scroll"===o.navigate){var a=e(t).find(".fn-gantt .rightPanel .dataPanel"),n=e(t).find(".nav-slider-bar"),l=n.find(".nav-slider-button"),i=n.width(),s=l.width(),r=a.css("margin-left")||0;r&&(r=r.replace("px",""));var d=r*i/t.scrollNavigation.panelMaxPos;l.css("left",d-s/2)}},repositionLabel:function(t){setTimeout(function(){var a;t?a=e(t).find(".fn-gantt .rightPanel").find(".dataPanel"):a=e(".fn-gantt .rightPanel .dataPanel");o.useCookie&&e.cookie(o.cookieKey+"ScrollPos",a.css("margin-left").replace("px",""))},200)},switchScrollButton:function(t){var a=e(t).find(".fn-gantt .bottom .navigate");a.find("button.nav-begin, button.nav-prev-week, button.nav-prev-day, button.nav-next-day, button.nav-next-week, button.nav-end").prop("disabled",!1);var n=e(t).find(".fn-gantt .rightPanel .dataPanel"),l=parseInt(n.css("margin-left").replace("px",""),10);a.find("button.nav-begin, button.nav-prev-week, button.nav-prev-day").prop("disabled",!t.scrollNavigation.canScroll||l>=0),a.find("button.nav-end, button.nav-next-week, button.nav-next-day").prop("disabled",!t.scrollNavigation.canScroll||l<=t.scrollNavigation.panelMaxPos)},waitToggle:function(t,a){if(e.isFunction(a)){var n=e(t);t.loader||(t.loader=e('<div class="fn-gantt-loader"><div class="fn-gantt-loader-spinner"><span>'+o.waitText+"</span></div></div>")),n.append(t.loader),setTimeout(a,200)}else t.loader&&t.loader.detach()}},r={getMaxDate:function(t){var a,n=null;switch(e.each(t.data,function(t,a){e.each(a.values,function(e,t){n=n<r.dateDeserialize(t.to)?r.dateDeserialize(t.to):n})}),n=n||new Date,t.scaleGroup){case"hours":var i=l[o.scale].scaleStep;n.setHours(Math.ceil(n.getHours()/i)*i),n.setHours(n.getHours()+3*i);break;case"weeks":a=new Date(n.getTime()),a=new Date(a.setDate(a.getDate()+21));var s=7*Math.floor(a.getDate()/7);n=new Date(a.getFullYear(),a.getMonth(),0===s?4:s-3);break;case"months":(a=new Date(n.getFullYear(),n.getMonth(),1)).setMonth(a.getMonth()+2),n=new Date(a.getFullYear(),a.getMonth(),1);break;case"days":default:n.setHours(0),n.setDate(n.getDate()+3)}return n},getMinDate:function(t){var a=null;switch(e.each(t.data,function(t,n){e.each(n.values,function(e,t){var n=r.dateDeserialize(t.from);isNaN(n)||(a=a>n||null===a?n:a)})}),a=a||new Date,t.scaleGroup){case"hours":var n=l[o.scale].scaleStep;a.setHours(Math.floor(a.getHours()/n)*n),a.setHours(a.getHours()-3*n);break;case"weeks":var i=new Date(a.getTime());i=new Date(i.setDate(i.getDate()-21));var s=7*Math.floor(i.getDate()/7);a=new Date(i.getFullYear(),i.getMonth(),0===s?4:s-3);break;case"months":a.setHours(0,0,0,0),a.setDate(1),a.setMonth(a.getMonth()-3);break;case"days":default:a.setHours(0,0,0,0),a.setDate(a.getDate()-3)}return a},parseDateRange:function(e,t){var a=new Date(e.getTime()),n=[],l=0;do{n[l++]=new Date(a.getTime()),a.setDate(a.getDate()+1)}while(a<=t);return n},parseTimeRange:function(e,t,n){var l=new Date(e),i=new Date(t);l.setHours(0,0,0,0),i.setMilliseconds(0),i.setSeconds(0),(i.getMinutes()>0||i.getHours()>0)&&(i.setMinutes(0),i.setHours(0),i.setTime(i.getTime()+864e5));for(var o=[],s=0;;){var r=new Date(l);if(r.setHours(Math.floor(l.getHours()/n)*n),o[s]&&r.getDay()!==o[s].getDay()&&r.setHours(0),o[s]=r,l>t)break;l=a(r,n),s++}return o},parseWeeksRange:function(e,t){var a=e.getDayForWeek(),n=[],l=0;do{n[l++]=a.getDayForWeek(),a.setDate(a.getDate()+7)}while(a<=t);return n},parseMonthsRange:function(e,t){var a=new Date(e),n=(new Date(t),[]),l=0;do{n[l++]=new Date(a.getFullYear(),a.getMonth(),1),a.setMonth(a.getMonth()+1)}while(a<=t);return n},dateDeserialize:function(t){return"string"==typeof t&&(t=t.replace(/\/Date\((.*)\)\//,"$1"),t=e.isNumeric(t)?parseInt(t,10):e.trim(t)),new Date(t)},genId:function(t){switch(e.isNumeric(t)&&(t=new Date(t)),l[o.scale].scaleGroup){case"hours":var a=t.getHours();return arguments.length>=2&&(a=Math.floor(t.getHours()/arguments[1])*arguments[1]),new Date(t.getFullYear(),t.getMonth(),t.getDate(),a).getTime();case"weeks":return t.getWeekId();case"months":return t.getFullYear()+"-"+t.getMonth();case"days":default:return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()}},_datesToDays:function(e){for(var t={},a=0,n=e.length;a<n;a++)t[r.dateDeserialize(e[a]).setHours(0,0,0,0)]=!0;return t},isHoliday:function(){if(!o.holidays||!o.holidays.length)return function(){return!1};var t=!1;return function(a){return t||(t=r._datesToDays(o.holidays)),!!t[e.isNumeric(a)?a:new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()]}}(),getCellSize:function(){if(void 0===r._getCellSize){var t=e('<div style="display: none; position: absolute;" class="fn-gantt"><div class="row"></div></div>');e("body").append(t),r._getCellSize=t.find(".row").height(),t.empty().remove()}return r._getCellSize},getPageHeight:function(e){return e.pageNum+1===e.pageCount?e.rowsOnLastPage*r.getCellSize():o.itemsPerPage*r.getCellSize()},getProgressBarMargin:function(){if(void 0===r._getProgressBarMargin){var t=e('<div style="display: none; position: absolute;"><div class="fn-gantt"><div class="rightPanel"><div class="dataPanel"><div class="row day"><div class="bar"></div></div></div></div></div></div>'),a=t.find(".fn-gantt .rightPanel .day .bar");e("body").append(t),r._getProgressBarMargin=parseInt(a.css("margin-left").replace("px",""),10),r._getProgressBarMargin+=parseInt(a.css("margin-right").replace("px",""),10),t.empty().remove()}return r._getProgressBarMargin}};this.each(function(){if(this.data=null,this.pageNum=0,this.pageCount=0,this.rowsOnLastPage=0,this.rowsNum=0,this.highlightedRow=null,this.hPosition=0,this.dateStart=null,this.dateEnd=null,this.scrollClicked=!1,this.scaleOldWidth=null,o.useCookie){var t=e.cookie(o.cookieKey+"CurrentScale");t?o.scale=t:e.cookie(o.cookieKey+"CurrentScale",o.scale)}this.scaleGroup=l[o.scale].scaleGroup,this.scrollNavigation={panelMouseDown:!1,scrollerMouseDown:!1,mouseX:null,repositionDelay:0,panelMaxPos:0,canScroll:!0},this.gantt=null,this.loader=null,s.create(this)})}}(jQuery);